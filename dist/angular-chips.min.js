!function(){function e(e){return e&&angular.isFunction(e.then)}function n(e){return{add:function(n){var t=angular.copy(e.$modelValue)||[];t.push(n),e.$setViewValue(t)},"delete":function(n){var t=angular.copy(e.$modelValue);t.splice(n,1),e.$setViewValue(t)},deleteByValue:function(n){var t,i;for(t=0;t<e.$modelValue.length;t++)if(angular.equals(e.$modelValue[t],n)){i=t;break}void 0!==i&&this["delete"](i)}}}function t(e,n){var t=this;this.type="defer",this.defer=e,this.isLoading=!1,this.isFailed=!1,n&&(t.isLoading=!0,n.then(function(e){t.defer=e,t.isLoading=!1},function(e){t.defer=e,t.isLoading=!1,t.isFailed=!0}))}function i(e){if(void 0!==e){var n,t;return n=e.indexOf("(")+1,t=e.indexOf(")"),e.substr(n,t-n)}}function r(r,o,a){function c(o,c,u,s,d){function p(e){return function(n){return 37===n?e--:e++,e=e<0?o.chips.list.length-1:e>o.chips.list.length-1?0:e}}if(""!==(error=l(c)))throw error;var f=n(s),h=u.hasOwnProperty("defer"),v=i(u.render);o.chips.list,o.chips.addChip=function(n){function i(e){o.chips.list.push(e),f.add(e)}var r,l;return void 0!==o.render&&""!==v?(l={},l[v]=n,r=o.render(l)):r=n,!!r&&(e(r)?(r.then(function(e){f.add(e)}),o.chips.list.push(new t(n,r)),o.$apply()):i(r),!0)},o.chips.deleteChip=function(e){var n=o.chips.list.splice(e,1)[0];return n.isFailed?void o.$apply():void(n instanceof t?f.deleteByValue(n.defer):f["delete"](e))},s.$render=function(){if(h&&s.$modelValue){var e,n=[];for(e=0;e<s.$modelValue.length;e++)n.push(new t(s.$modelValue[e]));o.chips.list=n}else o.chips.list=angular.copy(s.$modelValue)||[]};var m=null,g=angular.element("<div></div>"),C=c.html();C=C.substr(C.indexOf("<chip-tmpl"),C.indexOf("</chip-tmpl>")-"</chip-tmpl>".length),c.find("chip-tmpl").remove();var $=angular.element(C);$.attr("ng-repeat","chip in chips.list track by $index"),$.attr("ng-class","{'chip-failed':chip.isFailed}"),$.attr("tabindex","-1"),$.attr("index","{{$index+1}}"),g.append($);var y=r(g)(o);c.prepend(y),c.on("click",function(e){"CHIPS"===e.target.nodeName&&c.find("input")[0].focus()}),c.find("input").on("focus",function(){m=null}),o.chips.handleKeyDown=function(e){function n(){var n=parseInt(document.activeElement.getAttribute("index"))||(t=c.find("chip-tmpl")).length;t=c.find("chip-tmpl"),t[n-1].focus(),m=p(n-1),"INPUT"!==e.target.nodeName&&t[m(e.keyCode)].focus()}if(!("INPUT"!==e.target.nodeName&&"CHIP-TMPL"!==e.target.nodeName||0===c.find("chip-tmpl").length&&""===e.target.value)){var t;if(8===e.keyCode){if("INPUT"===e.target.nodeName&&""===e.target.value)n(),e.preventDefault();else if("CHIP-TMPL"===e.target.nodeName){var i=c.find("chip-tmpl");i.length>0&&parseInt(e.target.getAttribute("index"))-1===i.length&&c.find("chip-tmpl")[m(37)].focus()}}else 37!==e.keyCode&&39!==e.keyCode||(null===m?n():c.find("chip-tmpl")[m(e.keyCode)].focus())}},c.on("keydown",o.chips.handleKeyDown),a(c).addClass("chip-out-focus")}return c.$inject=["scope","iElement","iAttrs","ngModelCtrl","transcludefn"],{restrict:"E",scope:{render:"&?"},transclude:!0,require:"ngModel",link:c,controller:"chipsController",controllerAs:"chips",template:"<div ng-transclude></div>"}}function l(e){return 0===e.find("chip-tmpl").length?"should have chip-tmpl":e.find("chip-tmpl").length>1?"should have only one chip-tmpl":""}function o(e,n,t){this.setFocus=function(e){e?t(n).removeClass("chip-out-focus").addClass("chip-in-focus"):t(n).removeClass("chip-in-focus").addClass("chip-out-focus")},this.removeChip=function(e,n){this.deleteChip(n)}}r.$inject=["$compile","$timeout","DomUtil"],o.$inject=["$scope","$element","DomUtil"],angular.module("angular.chips",[]).directive("chips",r).controller("chipsController",o)}(),function(){function e(){return{restrict:"E",transclude:!0,link:function(e,n,t,i,r){r(e,function(e){n.append(e)}),n.on("keydown",function(n){8===n.keyCode&&(e.$broadcast("chip:delete"),n.preventDefault())})}}}angular.module("angular.chips").directive("chipTmpl",e)}(),function(){function e(){return{restrict:"A",require:"^?chips",link:function(e,n,t,i){function r(e,n){var t;if(n.search("\\(")>0&&(n=n.substr(0,n.search("\\("))),void 0!==n)if(n.split(".").length>1){var i=n.split(".");t=e;for(var r=0;r<i.length;r++)t=t[i[r]]}else t=e[n];return t}function l(e,n){var t=n.indexOf(".")!==-1?n.split(".")[0]:n.split("(")[0];return e.hasOwnProperty(t)?e:l(e.$parent,n)}function o(){if("string"==typeof e.chip||!e.chip.isLoading){var n,o=!0;t.hasOwnProperty("removeChip")&&""!==t.removeChip&&(n=r(l(e,t.removeChip),t.removeChip),o=n(e.chip)),o&&i.removeChip(e.chip,e.$index)}}n.on("click",function(){o()}),e.$on("chip:delete",function(){o()})}}}angular.module("angular.chips").directive("removeChip",e)}(),function(){function e(e){var n={};return n.addClass=function(t){return n.removeClass(e,t),e.attr("class",e.attr("class")+" "+t),n},n.removeClass=function(t){var i=e.attr("class").split(" "),r=i.indexOf(t);return r!==-1&&i.splice(r,1),e.attr("class",i.join(" ")),n},n}angular.module("angular.chips").factory("DomUtil",function(){return e})}(),function(){function e(){return{restrict:"A",require:"^chips",scope:{addOnBlur:"&?"},link:n}}function n(e,n,t,i){n.on("keypress",function(e){13===e.keyCode&&(""!==e.target.value&&i.addChip(e.target.value)&&(e.target.value=""),e.preventDefault())}),n.on("focus",function(){i.setFocus(!0)}),n.on("blur",function(){i.setFocus(!1),e.addOnBlur&&""!==event.target.value&&i.addChip(event.target.value)&&(event.target.value="")})}n.$inject=["scope","iElement","iAttrs","chipsCtrl"],angular.module("angular.chips").directive("chipControl",e)}(),function(){function e(){return{restrict:"A",require:["ngModel","^chips"],link:function(e,n,t,i){var r=i[0],l=i[1];r.$render=function(e){r.$modelValue&&l.addChip(r.$modelValue)&&n.val("")},n.on("focus",function(){l.setFocus(!0)}),n.on("blur",function(){l.setFocus(!1)})}}}angular.module("angular.chips").directive("ngModelControl",e)}();